<!DOCTYPE html>
<html>

<head>
  <!--Meta Data-->
  <meta charset="utf-8">
  <title>Lab 4</title>
  <!--Bootstrap-->
  <!--Css Egen-->
  <style>
/*  *{
    margin: 0;
    padding:0;

  }
   header{
     height: 20vh;
     width: 100vw;
     background-color: powderBlue;
     text-align: center;
     font-family: monospace;
   }
   header>h1{
     position: relative;
     left: 50%;
     top: 50%;
     transform: translate(-50%,-50%);
   }
    body{
      background-color: #f4f4f4;
    }
    .container div, .container button{
      display: block;
      margin: 10px;
      padding:5px;
      left: 30px;
    }*/
  </style>
  <!--Script-->
  <script type="text/javascript">
    window.addEventListener("load", function(event) {

      //variables for Add data, View data
      let titleAdd = document.getElementById("addTitle");
      let authorAdd = document.getElementById("addAuthor");

      let keyAdd;

      document.getElementById('requestKey').addEventListener("click", getKey);
      document.getElementById('addBook').addEventListener('click', addBook);
      document.getElementById("viewBtn").addEventListener("click", viewBook);


      function getKey(){
        fetch("https://www.forverkliga.se/JavaScript/api/crud.php?requestKey")
          .then((response) => response.json())
          .then((dataKey) => {
            document.getElementById('keyText').value = dataKey.key;
            keyAdd = dataKey.key;
          }).catch((error) => console.log(error))
      }
        function addBook(){
          let url = "https://www.forverkliga.se/JavaScript/api/crud.php?op=insert" + "&key=" + keyAdd + "&title=" + titleAdd.value + "&author=" + authorAdd.value;
          fetch(url)
          .then((response) => response.json())
          .then((result) => {
            if (result.status !== "error") {
                /*document.querySelector('label').innerHTML = 'Saved';*/
                console.log('succees');
              }else{
                alert("Sorry, please try again");
              }
          }).catch(function(error) {
               console.log(error);
            })
        }
        function  viewBook(){
          let url = "https://www.forverkliga.se/JavaScript/api/crud.php?op=select" + "&key=" + keyAdd;
          fetch(url)
          .then((response) => response.json())
          .then((data) => {
            let bookList = [];
            bookList.push(data);
            console.log(data);
            console.log(data.data.id);

            let output = '<h2> Book and ID: ' + data.id + '</h2>';
            bookList.forEach(function(book){
              output += `<ul>
              <li> Title: ${book.title}</li>
              <li> Author: ${book.author}</li>
              <li> #ID : ${book.id}</li>
              <li> Updated : ${book.updated}</li>
              </ul>
              `;
            });
            document.getElementById('viewDiv').innerHTML += '<div>' + output + '</div>';
          }).catch((error)=> console.log(error))
        }
    });
  </script>
</head>

<body>
  <!--HEADER-->
  <header>
    <h1>Lab 4 by Elin &amp; Anna</h1>
  </header>
  <!--MAIN-->
  <main>
    <div class="container">
      <div class="requestDiv">
        <button id="requestKey" type="button" name="button">Request API key</button>
        <p>Received: <input id="keyText" type="text" name="placeForKey" placeholder="Your Key... " value="" /></p>
      </div>
      <div class="addDiv">
        <button id='addBook' type="button" name="button">Add Book</button>
      <!--  <label for="addBook"></label> -->
        <input id="addTitle" type="text" name="addTitle" placeholder="Title" value="" />
        <input id="addAuthor" type="text" name="addAuthor" placeholder="Author" value="" />
      </div>
      <button id="viewBtn" type="button" name="button">View Books</button>
      <div id="viewDiv">

      </div>
      <div class="changeDiv">
        <button id="changeBook" type="button" name="button">Change Book</button>
        <input type="number" name="bookId" placeholder="Book id" value="">
        <input type="text" name="changeTitle" placeholder="Title" value="">
        <input type="text" name="changeAuthor" placeholder="Author" value="">
      </div>
      <div class="deleteDiv">
        <button id="deleteBtn" type="button" name="button">Delete Book</button>
        <input type="text" name="" placeholder="Book id" value="">
      </div>

    </div>
  </main>

  <!--FOOTER-->
  <footer>

  </footer>

</body>

</html>
